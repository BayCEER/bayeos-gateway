<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"  xmlns:sd="http://www.thymeleaf.org/spring-data" layout:decorator="main">
<head>
	<title th:text="#{board.list}">Board list</title>        
</head>
<body>
<div layout:fragment="content">	

	<div class="row">
		<div class="col-xs-12">
        <table id="table" class="table table-hover nowrap">
        <thead>        	                        
                <tr>                   
                   <th th:text="#{board.origin}">Origin</th>                   
                   <th th:text="#{board.group}" class="min-tablet-l">Group</th>
                   <th th:text="#{board.name}" class="min-tablet-l">Name</th>
                   <th th:text="#{board.rssi}" class="min-tablet-l">Rssi</th>
                   <th th:text="#{board.lrt}">Last Result Time</th>
                   <th th:text="#{board.status}">Status</th>
                   <th></th>
                   </tr>
         </thead>
         <tbody>
         </tbody>
		</table>
		</div>
	</div>

	 <script type="text/javascript" language="javascript" class="init" th:inline="javascript">
 		$(document).ready(function(){
 			var dt = $('#table').DataTable( {
 				"language": {
 					"lengthMenu" : 	/*[[#{datatable.lengthMenu}]]*/ ,
 					"zeroRecords" : /*[[#{datatable.zeroRecords}]]*/ , 					
 					"info": /*[[#{datatable.info}]]*/, 
 					"infoEmpty": /*[[#{datatable.infoEmpty}]]*/,
 					"infoFiltered": /*[[#{datatable.infoFiltered}]]*/,
 					"loadingRecords": /*[[#{datatable.loadingRecords}]]*/,
 					"search": /*[[#{datatable.search}]]*/,
 					"paginate" : {
 						"first" : /*[[#{datatable.first}]]*/,
 						"last" : /*[[#{datatable.last}]]*/,
 						"next" : /*[[#{datatable.next}]]*/,
 						"previous" : /*[[#{datatable.previous}]]*/,
 					}
 		        },
 				"responsive": true,
        		"autoWidth": false,
                "processing": true,
                "serverSide": true,
                "lengthChange": false,
                "columns": [					
                    {data: 'origin',
                     render: function(data,type,row) {
                    	 var url = /*[[ @{'/boards/'} ]]*/;
                    	 return '<a href="' + url + row.id +'">' + row.origin + '</a>' ;
                     } 
                    },
                    {data: 'boardGroup.name',
                      	render: function (data, type, row) {
                      		if (row.boardGroup != null) {
                      			var url = /*[[ @{'/boardgroups/'} ]]*/;
                            	return '<a href="' + url + row.boardGroup.id +'">' + row.boardGroup.name + '</a>' ;
                      		} else {
                            	return '';
                            }
                      	}
                    },
                    {data: 'name',
                      	render: function (data, type, row) {
                      		if (row.name != null) {
                      			return data;	
                      		} else {
                      			return '';
                      		}
                            
                      	}
                    },
                    {data: 'lastRssi', searchable: false,
                    	render: function(data,type,row){
                    		if (row.lastRssi != null) {
                    				if (row.lastRssi != 0){
                    					var url = /*[[ @{/resources/img/level_} ]]*/;
        	        			    	return '<img src="' + url + rssiLevel(row.lastRssi) + '.gif"/>';	
                    				} else {
                    					return '';
                    				}	                    			             			        
            			    } else {
            			        return '';
            			    }
                    	}
                    },
                    {data: 'lastResultTime', searchable: false,
                    	render: function(data,type,row){
                    		if (row.lastResultTime != null){
                    			var date = new Date(row.lastResultTime); 
                    			return date.toLocaleDateString() + " " + date.toLocaleTimeString();                    			
                    		} else {
                    			return '';
                    		}
                        	
                     	}
                    },                    
                    {data: 'channelStatus', searchable: false,
                     render: function(data,type,row){                                          
                    		if (row.channelStatus == 0){                    	
                    			var msg = /*[[ #{status.ok} ]]*/	
                    			return '<span class="label label-success">' + msg + '</span>';
                    		} else if (row.channelStatus == 1) {
                    			var mag = /*[[ #{status.warning} ]]*/;
                    			return '<span class="label label-warning">' + msg + '</span>';                    			
                    		} else if (row.channelStatus == 2) {
                    			var mag = /*[[ #{status.critical} ]]*/;
                    			return '<span class="label label-critical">' + msg + '</span>';
                    		}
                     }
                    },
                    { searchable: false, sortable: false,
                      render: function ( data, type, row ) {                      	                         	    
                    	    var ret = '<td class="link">';
            		        ret += '<a class="btn btn-xs btn-default" href="./boards/' + row.id + '"><span class="glyphicon glyphicon-edit"></span> Edit</a>';
            		        ret += '<a class="btn btn-xs btn-default" href="./charts/' + row.id + '"><span class="glyphicon glyphicon-stats"></span> Chart</a>';
            		        ret += '<a class="btn btn-xs btn-default" href="./boards/delete/' + row.id + '" onclick="return confirm(\'Are you sure?\');"><span class="glyphicon glyphicon-remove"></span> Remove</a>';
            			    return ret += '</td>';
                		}	
                    }
                                        
                ],
                "ajax": {
                	'contentType': 'application/json',
                	'url': /*[[ @{/rest/boards} ]]*/,
                	'type': 'POST',
                    'data': function(d) {
                            return JSON.stringify(d);
                    }
                } 
 			} );
		});
    
	</script>
</div>
</body>
</html>